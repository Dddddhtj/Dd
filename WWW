local _G = {
    ControllerID = 9822837105,
    CommandCooldown = {}
}

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")

local function isOwner(player)
    return player.UserId == _G.ControllerID
end

local function notifyPlayer(player, message)
    pcall(function()
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "Primadon System",
            Text = message,
            Icon = "rbxassetid://0",
            Duration = 5
        })
    end)
end

local function checkCooldown(player)
    if _G.CommandCooldown[player.UserId] and os.time() - _G.CommandCooldown[player.UserId] < 2 then
        notifyPlayer(player, "‚è≥ Wait 2 seconds between commands")
        return false
    end
    _G.CommandCooldown[player.UserId] = os.time()
    return true
end

local primadonModel = nil
local originalCharacter = nil
local isTransformed = false

local function transformToPrimadon(player)
    if not player.Character then 
        notifyPlayer(player, "‚ùå Character not found!")
        return nil
    end
    
    if isTransformed then
        notifyPlayer(player, "‚ùå Already transformed!")
        return nil
    end
    
    local success, result = pcall(function()
        originalCharacter = player.Character
        
        local model = game:GetObjects("rbxassetid://17523790773")[1]
        local monkyContainer = model:FindFirstChild("MonkyContainer")
        local mobChar = monkyContainer and monkyContainer:FindFirstChild("Main") and monkyContainer.Main:FindFirstChild("Monky")
        
        if not mobChar then
            error("Primadon model not found")
        end

        mobChar.Parent = workspace
        primadonModel = mobChar

        local humanoid = mobChar:WaitForChild("Humanoid")
        local hrp = mobChar:WaitForChild("HumanoidRootPart")

        hrp.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)

        humanoid.MaxHealth = 999999999
        humanoid.Health = 999999999
        humanoid.WalkSpeed = 32
        humanoid.JumpPower = 100
        humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None

        player.Character = mobChar

        local cam = workspace.CurrentCamera
        cam.CameraSubject = humanoid
        cam.CFrame = hrp.CFrame * CFrame.new(0, 5, 15)

        if monkyContainer then
            local mainModule = monkyContainer:FindFirstChild("MainModule")
            if mainModule then
                mainModule:Destroy()
            end
        end
        
        isTransformed = true
        return mobChar
    end)
    
    if success then
        notifyPlayer(player, "ü¶ç Primadon transformation successful!")
        setupPrimadonAbilities()
        return result
    else
        notifyPlayer(player, "‚ùå Transformation failed: " .. tostring(result))
        return nil
    end
end

local function revertToNormal(player)
    if not isTransformed then return false end
    
    if originalCharacter and originalCharacter.Parent then
        player.Character = originalCharacter
        
        local cam = workspace.CurrentCamera
        cam.CameraSubject = originalCharacter.Humanoid
        
        if primadonModel then
            primadonModel:Destroy()
            primadonModel = nil
        end
        
        isTransformed = false
        notifyPlayer(player, "üë§ Returned to normal form")
        return true
    end
    return false
end

local function processCommand(player, message)
    local command = message:lower()
    
    if not checkCooldown(player) then return end
    
    if isOwner(player) then
        if command == "!p" then
            if isTransformed then
                revertToNormal(player)
            else
                transformToPrimadon(player)
            end
        elseif command == "!primadon" then
            transformToPrimadon(player)
        elseif command == "!human" then
            revertToNormal(player)
        elseif command == "!help" then
            notifyPlayer(player, "ü¶ç Commands: !p (toggle), !primadon, !human")
        end
    else
        if command == "!p" or command == "!primadon" then
            notifyPlayer(player, "‚ùå Only the owner can use this command!")
        end
    end
end

local function monitorPlayer(player)
    player.Chatted:Connect(function(message)
        if message:lower():sub(1, 1) == "!" then
            processCommand(player, message)
        end
    end)
end

local function startMonitoring()
    for _, player in ipairs(Players:GetPlayers()) do
        monitorPlayer(player)
    end
end

Players.PlayerAdded:Connect(function(player)
    monitorPlayer(player)
    if isOwner(player) then
        print("‚≠ê Owner joined the game! (" .. _G.ControllerID .. ")")
        notifyPlayer(player, "üéÆ You are the owner! Use !p to transform into Primadon")
    end
end)

local function createAdvancedGUI()
    local player = Players.LocalPlayer
    local gui = Instance.new("ScreenGui")
    gui.Name = "PrimadonAdvancedGUI"
    gui.Parent = player:WaitForChild("PlayerGui")
    
    local mainFrame = Instance.new("Frame")
    mainFrame.Size = UDim2.new(0, 250, 0, 200)
    mainFrame.Position = UDim2.new(0, 10, 0, 10)
    mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
    mainFrame.BorderSizePixel = 0
    mainFrame.Parent = gui
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame
    
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 50)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 30))
    })
    gradient.Rotation = 45
    gradient.Parent = mainFrame
    
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, 0, 0, 35)
    title.Position = UDim2.new(0, 0, 0, 0)
    title.BackgroundColor3 = Color3.fromRGB(25, 25, 35)
    title.Text = "ü¶ç PRIMADON CONTROLS"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.Font = Enum.Font.GothamBold
    title.TextSize = 16
    title.Parent = mainFrame
    
    local titleCorner = Instance.new("UICorner")
    titleCorner.CornerRadius = UDim.new(0, 12)
    titleCorner.Parent = title
    
    local closeButton = Instance.new("TextButton")
    closeButton.Size = UDim2.new(0, 25, 0, 25)
    closeButton.Position = UDim2.new(1, -30, 0, 5)
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 60, 60)
    closeButton.Text = "X"
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 14
    closeButton.Parent = title
    
    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 8)
    closeCorner.Parent = closeButton
    
    closeButton.MouseButton1Click:Connect(function()
        gui:Destroy()
    end)
    
    local controlsFrame = Instance.new("Frame")
    controlsFrame.Size = UDim2.new(1, -10, 1, -45)
    controlsFrame.Position = UDim2.new(0, 5, 0, 40)
    controlsFrame.BackgroundTransparency = 1
    controlsFrame.Parent = mainFrame
    
    local abilities = {
        {Key = "M", Name = "EXECUTE", Color = Color3.fromRGB(255, 50, 50), Desc = "Powerful attack"},
        {Key = "J", Name = "AWAKEN", Color = Color3.fromRGB(255, 150, 50), Desc = "Unleash rage"},
        {Key = "C", Name = "GRAB", Color = Color3.fromRGB(50, 150, 255), Desc = "Grab and throw"},
        {Key = "X", Name = "SWIPE", Color = Color3.fromRGB(150, 255, 50), Desc = "Area damage"}
    }
    
    for i, ability in ipairs(abilities) do
        local abilityFrame = Instance.new("Frame")
        abilityFrame.Size = UDim2.new(1, 0, 0, 35)
        abilityFrame.Position = UDim2.new(0, 0, 0, (i-1) * 38)
        abilityFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
        abilityFrame.BorderSizePixel = 0
        abilityFrame.Parent = controlsFrame
        
        local abilityCorner = Instance.new("UICorner")
        abilityCorner.CornerRadius = UDim.new(0, 8)
        abilityCorner.Parent = abilityFrame
        
        local keyLabel = Instance.new("TextLabel")
        keyLabel.Size = UDim2.new(0, 30, 1, 0)
        keyLabel.Position = UDim2.new(0, 5, 0, 0)
        keyLabel.BackgroundColor3 = ability.Color
        keyLabel.Text = ability.Key
        keyLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        keyLabel.Font = Enum.Font.GothamBold
        keyLabel.TextSize = 12
        keyLabel.Parent = abilityFrame
        
        local keyCorner = Instance.new("UICorner")
        keyCorner.CornerRadius = UDim.new(0, 6)
        keyCorner.Parent = keyLabel
        
        local nameLabel = Instance.new("TextLabel")
        nameLabel.Size = UDim2.new(0, 100, 0, 20)
        nameLabel.Position = UDim2.new(0, 40, 0, 2)
        nameLabel.BackgroundTransparency = 1
        nameLabel.Text = ability.Name
        nameLabel.TextColor3 = ability.Color
        nameLabel.Font = Enum.Font.GothamBold
        nameLabel.TextSize = 12
        nameLabel.TextXAlignment = Enum.TextXAlignment.Left
        nameLabel.Parent = abilityFrame
        
        local descLabel = Instance.new("TextLabel")
        descLabel.Size = UDim2.new(0, 150, 0, 15)
        descLabel.Position = UDim2.new(0, 40, 0, 18)
        descLabel.BackgroundTransparency = 1
        descLabel.Text = ability.Desc
        descLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        descLabel.Font = Enum.Font.Gotham
        descLabel.TextSize = 10
        descLabel.TextXAlignment = Enum.TextXAlignment.Left
        descLabel.Parent = abilityFrame
    end
    
    local statsFrame = Instance.new("Frame")
    statsFrame.Size = UDim2.new(1, -10, 0, 25)
    statsFrame.Position = UDim2.new(0, 5, 1, -30)
    statsFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
    statsFrame.BorderSizePixel = 0
    statsFrame.Parent = mainFrame
    
    local statsCorner = Instance.new("UICorner")
    statsCorner.CornerRadius = UDim.new(0, 6)
    statsCorner.Parent = statsFrame
    
    local statsLabel = Instance.new("TextLabel")
    statsLabel.Size = UDim2.new(1, 0, 1, 0)
    statsLabel.Position = UDim2.new(0, 0, 0, 0)
    statsLabel.BackgroundTransparency = 1
    statsLabel.Text = "‚ö° SPEED: 32 | üí™ POWER: MAX"
    statsLabel.TextColor3 = Color3.fromRGB(100, 255, 100)
    statsLabel.Font = Enum.Font.Gotham
    statsLabel.TextSize = 11
    statsLabel.Parent = statsFrame
    
    local dragInput
    local dragStart
    local startPos
    
    local function update(input)
        local delta = input.Position - dragStart
        mainFrame.Position = UDim2.new(0, startPos.X.Offset + delta.X, 0, startPos.Y.Offset + delta.Y)
    end
    
    title.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragStart = input.Position
            startPos = mainFrame.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragInput = nil
                end
            end)
        end
    end)
    
    title.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)
    
    UIS.InputChanged:Connect(function(input)
        if input == dragInput then
            update(input)
        end
    end)
    
    return gui
end

local function setupPrimadonAbilities()
    UIS.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        
        if not isTransformed then return end
        
        local player = Players.LocalPlayer
        if not isOwner(player) then return end
        
        if input.KeyCode == Enum.KeyCode.M then
            notifyPlayer(player, "üí• EXECUTE ACTIVATED!")
            
            if primadonModel then
                local humanoid = primadonModel:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.WalkSpeed = 50
                    task.wait(3)
                    humanoid.WalkSpeed = 32
                end
            end
            
        elseif input.KeyCode == Enum.KeyCode.J then
            notifyPlayer(player, "üî• AWAKEN ACTIVATED!")
            
        elseif input.KeyCode == Enum.KeyCode.C then
            notifyPlayer(player, "üîÑ GRAB ACTIVATED!")
            
        elseif input.KeyCode == Enum.KeyCode.X then
            notifyPlayer(player, "‚ö° SWIPE ACTIVATED!")
        end
    end)
end

local function initializeAnimationSystem()
    local animators = setmetatable({},{__mode = "k"})
    local FPS = 60
    local secsPerFrame = 1/FPS
    local blankPoses = true

    local priorityOrder = {
        [Enum.AnimationPriority.Core] = 1,
        [Enum.AnimationPriority.Idle] = 2,
        [Enum.AnimationPriority.Movement] = 3,
        [Enum.AnimationPriority.Action] = 4,
        [Enum.AnimationPriority.Action2] = 5,
        [Enum.AnimationPriority.Action3] = 6,
        [Enum.AnimationPriority.Action4] = 7,
    }

    local ArtificialHB = Instance.new("BindableEvent")
    ArtificialHB.Name = "Heartbeat"

    local tf = 0
    local allowframeloss = false
    local tossremainder = false
    local frame = 1/FPS
    ArtificialHB:Fire()

    RunService.Heartbeat:Connect(function(s, p)
        tf += s
        if tf >= frame then
            ArtificialHB:Fire()
            tf = 0
        end
    end)

    local function processAnimators()
        for animator in animators do
            for _, track in pairs(animator.Tracks) do
                if track.IsPlaying then
                    track.StepTime += secsPerFrame * track.Speed
                end
            end
        end
    end

    ArtificialHB.Event:Connect(processAnimators)
end

print("ü¶ç Primadon System activated!")
print("‚≠ê Owner ID: " .. _G.ControllerID)
startMonitoring()
setupPrimadonAbilities()
initializeAnimationSystem()

local localPlayer = Players.LocalPlayer
if localPlayer and isOwner(localPlayer) then
    notifyPlayer(localPlayer, "ü¶ç Primadon system ready! Use !p to transform")
    createAdvancedGUI()
end

RunService.Heartbeat:Connect(function()
    if primadonModel and primadonModel.Parent then
        local humanoid = primadonModel:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.Health = 999999999
        end
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if player == localPlayer and isTransformed then
        revertToNormal(player)
    end
end)

return {
    activate = function() 
        print("Primadon system fully activated!")
    end,
    
    transformToPrimadon = transformToPrimadon,
    revertToNormal = revertToNormal,
    isOwner = isOwner,
    
    getInfo = function()
        return {
            OwnerID = _G.ControllerID,
            TotalPlayers = #Players:GetPlayers(),
            IsOwner = isOwner(Players.LocalPlayer),
            IsPrimadon = isTransformed
        }
    end
}
